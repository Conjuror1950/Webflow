(function () {
  // Inserisci il CSS nel <head> per evitare flash dell'elemento
  const style = document.createElement("style");
  style.textContent = `
    #video-toggle {
      opacity: 0;
      visibility: hidden;
      transition: opacity 1s ease-in-out;
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      cursor: pointer;
    }
  `;
  document.head.appendChild(style);

  // SVG inline senza la dichiarazione XML
  const playSvg = `
  <svg version="1.1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M8,5v14l11,-7Z" fill="#fff"></path>
    <path fill="none" d="M0,0h24v24h-24Z"></path>
  </svg>`;

  const pauseSvg = `
  <svg version="1.1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <!--Generated by IJSVG (https://github.com/iconjar/IJSVG)-->
    <path d="M6,19h4v-14h-4v14Zm8,-14v14h4v-14h-4Z" fill="#fff"></path>
    <path fill="none" d="M0,0h24v24h-24Z"></path>
  </svg>`;

  // Crea l'elemento per l'icona e inserisce l'SVG di play (stato iniziale)
  const videoToggle = document.createElement("div");
  videoToggle.id = "video-toggle";
  videoToggle.style.opacity = "0";
  videoToggle.style.visibility = "hidden";
  videoToggle.innerHTML = playSvg;
  document.body.appendChild(videoToggle);

  // Funzione per caricare jQuery se non è già presente
  function onJQueryReady(callback) {
    if (window.jQuery) {
      callback();
    } else {
      const script = document.createElement("script");
      script.src = "https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js";
      script.onload = callback;
      document.head.appendChild(script);
    }
  }

  onJQueryReady(function () {
    $(document).ready(function () {
      console.log("jQuery è pronto");

      // Funzione per aggiornare l'icona in base allo stato del video
      function updateIcon() {
        const video = $("video").get(0);
        if (video) {
          if (video.paused) {
            videoToggle.innerHTML = playSvg;
          } else {
            videoToggle.innerHTML = pauseSvg;
          }
        } else {
          console.warn("Nessun elemento <video> trovato nella pagina");
        }
      }

      // Aggiunge listener per gli eventi 'play' e 'pause'
      $("video").on("play pause", updateIcon);

      // Funzione per alternare play/pause del video
      function togglePlayPause() {
        $("video").each(function () {
          if (this.paused) {
            this.play();
          } else {
            this.pause();
          }
        });
      }

      // Associa l'evento click all'icona per gestire play/pause
      $("#video-toggle").click(function () {
        togglePlayPause();
      });

      // Rende visibile l'icona dopo 1 secondo (modifica il delay se necessario)
      setTimeout(function () {
        $("#video-toggle").css({
          visibility: "visible",
          opacity: "1",
        });
        console.log("Icona resa visibile");
      }, 1000);

      // Aggiorna subito l'icona in base allo stato iniziale del video
      updateIcon();
    });
  });
})();
